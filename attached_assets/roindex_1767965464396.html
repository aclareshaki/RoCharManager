<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RO Account Manager - MuhRO Style</title>
    <style>
        /* --- EST칄TICA RAGNAROK ONLINE --- */
        :root {
            --bg-dark: #0a1018;
            --panel-blue: rgba(16, 32, 48, 0.95);
            --panel-border: #2b4e6b;
            --text-main: #ffffff;
            --text-secondary: #a0c0e0;
            --card-bg: #f0f4f8;
            --card-border: #8faab9;
            --highlight: #5a8bbd;
            --input-bg: #1c2b3a;
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Verdana', sans-serif; /* Fuente cl치sica de RO */
            background-color: var(--bg-dark);
            background-image: radial-gradient(circle at 50% 50%, #152233 0%, #05080c 100%);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- HEADER & CONTROLES --- */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 10px 20px;
            background: var(--panel-blue);
            border: 1px solid var(--panel-border);
            border-radius: 4px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }

        h1 { font-size: 18px; margin: 0; color: #cedce7; text-transform: uppercase; letter-spacing: 1px; }

        .controls { display: flex; gap: 10px; }
        
        button {
            background: linear-gradient(to bottom, #4a6c8a, #2b4257);
            border: 1px solid #7eaac7;
            color: white;
            padding: 5px 15px;
            cursor: pointer;
            font-size: 12px;
            font-family: 'Verdana';
            border-radius: 3px;
        }
        button:hover { filter: brightness(1.2); }

        .search-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        input {
            background: var(--input-bg);
            border: 1px solid var(--panel-border);
            color: white;
            padding: 8px;
            border-radius: 3px;
            font-size: 12px;
            width: 100%;
        }

        /* --- LAYOUT PRINCIPAL --- */
        .main-container {
            display: flex;
            gap: 20px;
            height: 100%;
        }

        /* --- PANEL IZQUIERDO: CUENTAS (Estilo Imagen 1) --- */
        .account-panel {
            width: 300px;
            background: var(--panel-blue);
            border: 1px solid var(--panel-border);
            border-radius: 4px;
            display: flex;
            flex-direction: column;
            padding: 10px;
            flex-shrink: 0;
        }

        .panel-title {
            font-weight: bold;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid var(--panel-border);
        }

        .account-list {
            overflow-y: auto;
            flex-grow: 1;
        }

        /* Scrollbar estilo RO */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f1a24; }
        ::-webkit-scrollbar-thumb { background: #3d5e7a; border-radius: 4px; }

        .account-item {
            display: flex;
            align-items: center;
            background: linear-gradient(to right, rgba(255,255,255,0.05), transparent);
            border: 1px solid #2a4055;
            margin-bottom: 5px;
            padding: 10px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .account-item:hover, .account-item.active {
            background: linear-gradient(to right, rgba(90, 139, 189, 0.3), transparent);
            border-color: var(--highlight);
        }

        .drag-handle {
            color: #5a7a99;
            margin-right: 10px;
            font-size: 18px;
            cursor: move;
        }

        /* --- PANEL DERECHO: PERSONAJES (Estilo Imagen 2) --- */
        .char-panel {
            flex-grow: 1;
            background: rgba(0,0,0,0.3);
            border-radius: 4px;
            padding: 10px;
            overflow-y: auto;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            align-content: start;
        }

        .char-card {
            background: linear-gradient(to bottom, #ffffff, #e6ecf5);
            border: 2px solid #8faab9; /* Borde azulado claro */
            border-radius: 4px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            color: #333;
            position: relative;
            box-shadow: 0 0 5px rgba(0,0,0,0.3);
            transition: transform 0.2s;
        }

        .char-card:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.5); }

        .char-header {
            width: 100%;
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .badge-class { font-size: 10px; background: #333; color: white; padding: 2px 4px; border-radius: 3px; }
        .badge-lvl { font-size: 10px; background: #5a8bbd; color: white; padding: 2px 4px; border-radius: 3px; }

        /* Placeholder del Sprite */
        .sprite-area {
            width: 100px;
            height: 100px;
            background: url('https://upload.wikimedia.org/wikipedia/commons/8/89/Portrait_Placeholder.png') no-repeat center bottom; 
            background-size: contain;
            margin: 10px 0;
            image-rendering: pixelated; /* Crucial para pixel art */
        }
        
        /* Simular inputs transparentes para edici칩n */
        .editable {
            background: transparent;
            border: none;
            text-align: center;
            font-family: inherit;
            width: 100%;
            color: #333;
            cursor: text;
        }
        .char-name { font-weight: bold; font-size: 14px; margin-bottom: 5px; color: #1a3c5e; }
        .char-class-text { font-size: 12px; color: #666; }

        .btn-add {
            background: rgba(255,255,255,0.1);
            border: 2px dashed #444;
            color: #aaa;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            min-height: 200px;
        }
        .btn-add:hover { background: rgba(255,255,255,0.2); color: white; }

        /* Modal simple */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            display: none; justify-content: center; align-items: center; z-index: 100;
        }
        .modal-content {
            background: var(--panel-blue);
            border: 1px solid var(--highlight);
            padding: 20px; width: 300px;
            display: flex; flex-direction: column; gap: 10px;
        }
    </style>
</head>
<body>

<header>
    <h1>MuhRO Account Manager</h1>
    <div class="controls">
        <button onclick="exportData()">Exportar JSON</button>
        <button onclick="document.getElementById('importFile').click()">Importar JSON</button>
        <input type="file" id="importFile" style="display:none" onchange="importData(this)">
    </div>
</header>

<div class="search-bar">
    <input type="text" id="searchInput" placeholder="Buscar por Nombre, Clase o Nivel..." onkeyup="filterAll()">
</div>

<div class="main-container">
    <div class="account-panel">
        <div class="panel-title">Game Account</div>
        <div class="account-list" id="accountList">
            </div>
        <button onclick="addAccount()" style="margin-top: 10px; width:100%">+ Nueva Cuenta</button>
    </div>

    <div class="char-panel" id="charContainer">
        <div style="color: #666; text-align: center; margin-top: 50px; width: 100%;">
            Selecciona una cuenta a la izquierda para ver sus personajes
        </div>
    </div>
</div>

<div class="modal" id="charModal">
    <div class="modal-content">
        <h3>Nuevo Personaje</h3>
        <input type="text" id="newCharName" placeholder="Nombre">
        <input type="text" id="newCharClass" placeholder="Clase (ej. Arch Bishop)">
        <input type="number" id="newCharLvl" placeholder="Nivel">
        <button onclick="saveNewChar()">Guardar</button>
        <button onclick="closeModal()" style="background:#555">Cancelar</button>
    </div>
</div>

<script>
    // --- ESTADO INICIAL ---
    let db = [
        {
            id: 1, name: "Kolanthes", chars: [
                { id: 101, name: "SalmonHaki", class: "Biolo", lvl: 250 },
                { id: 102, name: "AkumaNoMi", class: "Novice", lvl: 10 }
            ]
        },
        { id: 2, name: "Kuma", chars: [] },
        { id: 3, name: "akeruh", chars: [] }
    ];

    let currentAccountId = null;

    // --- RENDERIZADO ---
    
    function renderAccounts() {
        const list = document.getElementById('accountList');
        list.innerHTML = '';
        
        db.forEach(acc => {
            const div = document.createElement('div');
            div.className = `account-item ${currentAccountId === acc.id ? 'active' : ''}`;
            div.onclick = () => selectAccount(acc.id);
            div.innerHTML = `
                <span class="drag-handle">::</span>
                <input type="text" value="${acc.name}" 
                       class="editable" 
                       style="color: white; text-align:left; font-size: 14px;"
                       onchange="updateAccountName(${acc.id}, this.value)"
                       onclick="event.stopPropagation()">
            `;
            list.appendChild(div);
        });
    }

    function selectAccount(id) {
        currentAccountId = id;
        renderAccounts(); // Para actualizar la clase 'active'
        renderCharacters();
    }

    function renderCharacters(filteredChars = null) {
        const container = document.getElementById('charContainer');
        container.innerHTML = '';

        if (!currentAccountId && !filteredChars) return;

        // Si venimos del buscador, usamos filteredChars, si no, los de la cuenta actual
        let displayChars = filteredChars;
        if (!displayChars && currentAccountId) {
            const account = db.find(a => a.id === currentAccountId);
            displayChars = account ? account.chars : [];
        }

        displayChars.forEach(char => {
            const card = document.createElement('div');
            card.className = 'char-card';
            
            // Intentamos mapear imagenes (placeholder logic)
            // Aqu칤 podr칤as poner l칩gica: si clase == 'Biolo' url = 'biolo.png'
            const spriteUrl = `https://static.divine-pride.net/images/jobs/png/male/${getClassId(char.class)}.png`; 
            
            card.innerHTML = `
                <div class="char-header">
                    <span class="badge-class">Job</span>
                    <input type="number" value="${char.lvl}" class="editable badge-lvl" style="width: 40px" onchange="updateChar(${char.id}, 'lvl', this.value)">
                </div>
                <div class="sprite-area">
                    <img src="https://static.divine-pride.net/images/items/collection/501.png" style="width:100%; opacity:0.2; position:absolute; top:10px; left:0;">
                    <div style="position:relative; z-index:2; text-align:center; padding-top:20px; font-size:30px;">游</div>
                </div>
                <input type="text" value="${char.name}" class="editable char-name" onchange="updateChar(${char.id}, 'name', this.value)">
                <input type="text" value="${char.class}" class="editable char-class-text" onchange="updateChar(${char.id}, 'class', this.value)">
            `;
            container.appendChild(card);
        });

        // Bot칩n a침adir solo si estamos en vista de cuenta (no b칰squeda global)
        if (currentAccountId && !filteredChars) {
            const btn = document.createElement('div');
            btn.className = 'char-card btn-add';
            btn.innerHTML = '+ A침adir Char';
            btn.onclick = openModal;
            container.appendChild(btn);
        }
    }

    // --- L칍GICA DE DATOS ---

    function updateAccountName(id, val) {
        const acc = db.find(a => a.id === id);
        if (acc) acc.name = val;
    }

    function updateChar(id, field, val) {
        // Buscar char en todas las cuentas
        db.forEach(acc => {
            const char = acc.chars.find(c => c.id === id);
            if (char) char[field] = val;
        });
    }

    function addAccount() {
        const newId = Date.now();
        db.push({ id: newId, name: "Nueva Cuenta", chars: [] });
        renderAccounts();
    }

    // --- MODAL & A칌ADIR ---
    function openModal() { document.getElementById('charModal').style.display = 'flex'; }
    function closeModal() { document.getElementById('charModal').style.display = 'none'; }
    
    function saveNewChar() {
        const name = document.getElementById('newCharName').value;
        const cls = document.getElementById('newCharClass').value;
        const lvl = document.getElementById('newCharLvl').value;

        if (currentAccountId && name) {
            const acc = db.find(a => a.id === currentAccountId);
            acc.chars.push({
                id: Date.now(),
                name: name,
                class: cls || "Novice",
                lvl: lvl || 1
            });
            renderCharacters();
            closeModal();
            // Reset inputs
            document.getElementById('newCharName').value = '';
        }
    }

    // --- BUSCADOR ---
    function filterAll() {
        const term = document.getElementById('searchInput').value.toLowerCase();
        
        if (term === '') {
            if (currentAccountId) selectAccount(currentAccountId);
            else renderAccounts();
            return;
        }

        // Estrategia: Mostrar cuentas que coincidan O que tengan chars que coincidan
        const accountList = document.getElementById('accountList');
        accountList.innerHTML = '';

        let matchedAccounts = [];

        db.forEach(acc => {
            const nameMatch = acc.name.toLowerCase().includes(term);
            const charMatch = acc.chars.some(c => 
                c.name.toLowerCase().includes(term) || 
                c.class.toLowerCase().includes(term) ||
                c.lvl.toString().includes(term)
            );

            if (nameMatch || charMatch) {
                const div = document.createElement('div');
                div.className = `account-item ${currentAccountId === acc.id ? 'active' : ''}`;
                div.onclick = () => selectAccount(acc.id);
                // Highlight visual si hay match de chars
                div.innerHTML = `
                    <span class="drag-handle" style="color:${charMatch ? '#5a8bbd' : '#555'}">::</span>
                    <span style="color:white">${acc.name} ${charMatch ? '<span style="font-size:10px; color:#aaa">(Matches)</span>' : ''}</span>
                `;
                accountList.appendChild(div);
            }
        });
    }

    // --- HELPER FAKE ---
    function getClassId(className) {
        // Esto es solo para intentar sacar una imagen, idealmente tendr칤as un mapa real
        // return 0 para novice, etc.
        return 0; 
    }

    // --- EXPORT / IMPORT ---
    function exportData() {
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(db));
        const node = document.createElement('a');
        node.setAttribute("href", dataStr);
        node.setAttribute("download", "ro_accounts.json");
        document.body.appendChild(node);
        node.click();
        node.remove();
    }

    function importData(input) {
        const file = input.files[0];
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                db = JSON.parse(e.target.result);
                renderAccounts();
                renderCharacters(); // limpia vista derecha
                alert("Datos cargados correctamente");
            } catch (err) {
                alert("Error al leer el archivo JSON");
            }
        };
        reader.readAsText(file);
    }

    // Init
    renderAccounts();

</script>
</body>
</html>